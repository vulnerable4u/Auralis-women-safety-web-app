<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Women Safety Assistant</title>
    <meta name="csrf-token" content="disabled">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.0.1/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/maplibre-gl@3.0.1/dist/maplibre-gl.js"></script>
</head>
<body>
    <div id="loading-screen" class="loading-screen">
        <div class="loading-background">
            <div class="bg-circle circle-1"></div>
            <div class="bg-circle circle-2"></div>
            <div class="bg-circle circle-3"></div>
        </div>
        <div class="loading-content">
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h1 class="logo-text">Women Safety Assistant</h1>
            </div>
            <div class="loading-bar-container">
                <div class="loading-bar">
                    <div class="loading-progress"></div>
                </div>
            </div>
            <p class="loading-text">Initializing Safety System...</p>
            <div class="loading-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </div>
    
    <header class="topbar">
        <div class="topbar-left">
            <i class="fas fa-shield-alt"></i>
            <h1>Women Safety Assistant</h1>
        </div>
        <div class="topbar-right">
            <div class="status-chip" id="status-chip">
                <span class="status-label">Status:</span>
                <span class="status-value" id="status-value">SAFE</span>
                <span class="status-score" id="status-score">0.00</span>
            </div>
            {% if logged_in %}
                <div class="user-info">
                    {% if user_picture %}
                        <img src="{{ user_picture }}" alt="Profile" class="user-avatar">
                    {% else %}
                        <i class="fas fa-user user-avatar"></i>
                    {% endif %}
                    <span>Welcome, {{ user_name or username }}</span>
                </div>
                <a href="/logout" class="btn btn-secondary">Logout</a>
            {% else %}
                <a href="/user-login" class="btn btn-secondary">Login</a>
            {% endif %}
            <a href="/login" class="btn btn-admin">Admin</a>
            <a href="/about" class="btn btn-secondary">About</a>
            <button id="theme-toggle" class="btn btn-secondary" title="Toggle Dark Mode">
                <i class="fas fa-moon" id="theme-icon"></i>
            </button>
        </div>
    </header>

    <main class="main-content">
        <section class="camera-section">
            <h2><i class="fas fa-video"></i> Dual Camera Feed</h2>
            <div class="camera-container">
                <div class="camera-frame" id="front-camera-frame">
                    <video id="front-video" autoplay playsinline style="display: none;"></video>
                    <img id="server-front-video" src="/video_feed" alt="Front Camera" style="display: none;">
                    <div class="camera-label">
                        <i class="fas fa-user"></i> Front Camera
                    </div>
                    <div class="camera-fallback" id="front-fallback">
                        <i class="fas fa-camera"></i>
                        <p>Initializing front camera...</p>
                    </div>
                </div>
                <div class="camera-frame" id="back-camera-frame">
                    <video id="back-video" autoplay playsinline style="display: none;"></video>
                    <img id="server-back-video" src="/video_feed" alt="Back Camera" style="display: none;">
                    <div class="camera-label">
                        <i class="fas fa-mobile-alt"></i> Back Camera
                    </div>
                    <div class="camera-fallback" id="back-fallback">
                        <i class="fas fa-camera"></i>
                        <p>Initializing back camera...</p>
                    </div>
                </div>
            </div>
            <div class="camera-controls">
                <button id="start-monitoring" class="btn btn-primary">
                    <i class="fas fa-play"></i> Start Monitoring
                </button>
                <button id="stop-monitoring" class="btn btn-danger" style="display: none;">
                    <i class="fas fa-stop"></i> Stop Monitoring
                </button>
                <button id="sos-btn" class="btn btn-sos">
                    <i class="fas fa-exclamation-triangle"></i> SOS
                </button>
            </div>
        </section>

        <section class="dashboard-grid">
            <div class="panel threat-panel">
                <h2><i class="fas fa-chart-line"></i> Threat Monitor</h2>
                <div class="threat-chart-container">
                    <canvas id="threat-chart"></canvas>
                </div>
                <div class="threat-contributions">
                    <div class="contribution-item">
                        <label><i class="fas fa-microphone"></i> Speech Analysis (MFCC Emotion Detection)</label>
                        <div class="progress-bar">
                            <div class="progress-fill speech-fill" id="speech-progress" style="width: 0%"></div>
                        </div>
                        <span class="progress-value" id="speech-value">0%</span>
                    </div>
                    <div class="contribution-item">
                        <label><i class="fas fa-running"></i> Motion Detection</label>
                        <div class="progress-bar">
                            <div class="progress-fill motion-fill" id="motion-progress" style="width: 0%"></div>
                        </div>
                        <span class="progress-value" id="motion-value">0%</span>
                    </div>
                </div>
            </div>

            <div class="panel map-panel">
                <h2><i class="fas fa-map-marker-alt"></i> Safe Places Map</h2>
                <div id="map" class="map-container" style="height: 400px; width: 100%;"></div>
                <div class="map-info">
                    <p id="map-status">Initializing map...</p>
                </div>
            </div>
        </section>

        <section class="logs-section">
            <h2><i class="fas fa-list-alt"></i> Detection Logs</h2>
            <div class="logs-container" id="logs-container">
                <div class="log-entry info">
                    <span class="log-time">System</span>
                    <span class="log-message">Ready. Click "Start Monitoring" to begin.</span>
                </div>
            </div>
        </section>

        <section class="chatbot-section">
            <div class="chatbot-header-section">
                <h2><i class="fas fa-robot"></i> AI Safety Assistant</h2>
                <div class="chatbot-controls">
                    <label class="switch">
                        <input type="checkbox" id="auto-alert-toggle">
                        <span class="slider"></span>
                    </label>
                    <span class="switch-label">Auto-Alert Mode</span>
                </div>
            </div>
            <div class="chatbot-container">
                <div class="chatbot-messages" id="chatbot-messages">
                    <div class="chat-message bot">
                        <p><i class="fas fa-info-circle"></i> Hello! I'm your AI safety assistant. I can help you with:</p>
                        <ul>
                            <li>Finding nearest safe places</li>
                            <li>Emergency procedures</li>
                            <li>Safety recommendations</li>
                            <li>Auto-alerting contacts in emergencies</li>
                        </ul>
                        <p><strong>Auto-Alert Mode:</strong> When enabled, I'll automatically alert your emergency contacts and suggest the 2 nearest safe places when threat level is HIGH or CRITICAL.</p>
                    </div>
                </div>
                <div class="chatbot-input">
                    <input type="text" id="chatbot-input" placeholder="Type your message or ask for help...">
                    <button id="chatbot-send"><i class="fas fa-paper-plane"></i> Send</button>
                </div>
            </div>
        </section>
    </main>

    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>

